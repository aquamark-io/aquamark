<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aquamark.io - Watermark Documents</title>
  <script src="https://unpkg.com/pdf-lib"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5ff;
      margin: 0;
      padding: 2rem;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .btn {
      background: #3f51b5;
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Aquamark.io - Watermark Documents</h2>
    <div style="margin-bottom: 1rem;">
      <strong>How to Use:</strong>
      <ul>
        <li>1. Upload your logo (JPG or PNG)</li>
        <li>2. Upload up to 6 bank statements (PDF only)</li>
        <li>3. Click "Watermark Files" to begin processing</li>
      </ul>
      <small>Your files will not be stored. Downloads begin automatically after watermarking is complete.</small>
    </div>

    <h3>1. Upload Logo (JPG or PNG)</h3>
    <input type="file" id="logo" accept="image/*" />

    <h3>2. Upload Bank Statements (PDF only, up to 6)</h3>
    <input type="file" id="statements" multiple accept=".pdf" />

    <div style="margin-top: 1.5rem;">
      <button class="btn" onclick="watermarkFiles()">3. Watermark Files</button>
    </div>
  </div>

  <script>
<script>
  async function getUserEmail() {
    return new Promise((resolve, reject) => {
      let attempts = 0;
      const maxAttempts = 30; // ~3 seconds max

      const interval = setInterval(() => {
        const user = Outseta?.nocode?.user;
        if (user && user.Email) {
          clearInterval(interval);
          console.log("✅ Found user email:", user.Email);
          resolve(user.Email);
        }

        attempts++;
        if (attempts > maxAttempts) {
          clearInterval(interval);
          console.error("❌ Outseta.nocode.user not available in time.");
          resolve(null);
        }
      }, 100); // check every 100ms
    });
  
    async function watermarkFiles() {
      const email = await getUserEmail();
if (!email) {
  alert("User not authenticated. Please log in.");
  return;
}
      console.log("Tracking usage for:", email);

      // Your watermarking logic here...
      alert("✅ Watermarking logic goes here. (Tracking for: " + email + ")");
    }
  </script>
</body>
</html>
