<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Aquamark.io - Watermark</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <link rel="icon" href="/logo-icon-black-blue.jpg" type="image/jpg" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f9fb;
      color: #1e1e2f;
    }
    .aqua-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: #f3e8ff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }
    .aqua-logo {
      height: 28px;
    }
    .aqua-nav a {
      margin-left: 1.5rem;
      text-decoration: none;
      font-weight: 500;
      color: #333;
    }
    .aqua-panel {
      max-width: 1700px;
      margin: 2rem auto;
      padding: 0 2rem;
    }
    .aqua-dashboard {
      display: flex;
      gap: 2rem;
      align-items: flex-start;
    }
    .aqua-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      flex: 1;
    }
    .aqua-right-panel {
      width: 500px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .aqua-card, .progress-bar, .download-console {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .upload-box {
      border: 2px dashed #cce0f5;
      border-radius: 12px;
      background: #f8fbff;
      text-align: center;
      padding: 2rem 1rem;
      margin-bottom: 1rem;
      color: #667;
      font-weight: 500;
    }
    .upload-box input[type="file"] {
      display: none;
    }
    .aqua-btn {
      background-color: #2e6eff;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    .aqua-btn:hover {
      background-color: #1f54d9;
    }
    .upgrade-btn {
      background-color: #28a745;
      color: white;
      font-weight: 600;
      font-size: 15px;
      padding: 14px 22px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      margin-top: 1rem;
      width: 100%;
    }
    .stored-logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      overflow: hidden;
      text-align: center;
    }
    .stored-logo-container img {
      max-height: 300px;
      max-width: 100%;
      height: auto;
      object-fit: contain;
    }
    .sample-preview.small-preview {
      position: relative;
      width: 100%;
      height: 350px;
      background: #f9f9f9;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 1rem;
    }
    .sample-preview img.statement-image,
    .sample-preview canvas#sampleCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 1;
    }
    canvas#sampleCanvas {
      z-index: 2;
      pointer-events: none;
    }
    .download-console ul {
      padding-left: 0;
      list-style-type: none;
      margin: 0;
    }
    .download-console li {
      margin-bottom: 1rem;
      border: 1px solid #ddd;
      padding: 0.75rem 1rem;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #c9c7c7;
    }
    .download-icon {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    @media (max-width: 1024px) {
      .aqua-dashboard {
        flex-direction: column;
      }
      .aqua-right-panel {
        width: 100%;
      }
      .aqua-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <header class="aqua-header">
    <img src="/logo-full-black-blue.png" alt="Aquamark.io" class="aqua-logo" />
    <nav class="aqua-nav">
      <a href="/dashboard.html">Dashboard</a>
      <a href="/watermark.html">Watermark</a>
      <a href="/">Log Out</a>
    </nav>
  </header>

  <main class="aqua-panel">
    <h1>Watermark Panel</h1>
    <div class="aqua-dashboard">
      <div class="aqua-grid">
        <div class="aqua-card">
          <h2>Upload Logo</h2>
          <label for="logoUpload" class="upload-box">
            <p>Drag & drop or click to upload</p>
            <input type="file" id="logoUpload" accept="image/png, image/jpeg">
          </label>
          <button id="uploadLogoBtn" class="aqua-btn">Upload Logo</button>
        </div>
        <div class="aqua-card">
          <h2>Upload Bank Statements</h2>
          <label class="upload-box">
            <p>Drag & drop or click to upload</p>
            <input type="file" accept="application/pdf" multiple>
          </label>
          <div class="upload-disclaimer">PDF only, max 25MB</div>
          <button class="aqua-btn">Start Watermark</button>
        </div>
        <div class="aqua-card">
          <h2>Stored Logo</h2>
          <div class="stored-logo-container">
            <img id="logoPreview" src="" alt="Stored Logo">
          </div>
        </div>
        <div class="aqua-card">
          <h2>Sample</h2>
          <div class="sample-preview small-preview">
            <img src="/sample-bank-statement.jpg" class="statement-image" />
            <canvas id="sampleCanvas"></canvas>
          </div>
        </div>
      </div>
      <div class="aqua-right-panel">
        <div class="progress-bar">
          <h2>Watermark Status</h2>
          <progress max="100" value="0" style="width: 100%; height: 20px;"></progress>
        </div>
        <div class="download-console">
          <h2>Download Console</h2>
          <ul>
            <li>File1.pdf <img src="/download-icon.png" class="download-icon" /></li>
            <li>File2.pdf <img src="/download-icon.png" class="download-icon" /></li>
            <li>File3.pdf <img src="/download-icon.png" class="download-icon" /></li>
            <li>File4.pdf <img src="/download-icon.png" class="download-icon" /></li>
            <li>File5.pdf <img src="/download-icon.png" class="download-icon" /></li>
            <li>File6.pdf <img src="/download-icon.png" class="download-icon" /></li>
          </ul>
        </div>
        <button class="upgrade-btn">Upgrade Plan</button>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = supabase.createClient(
      "https://dvzmnikrvkvgragzhrof.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2em1uaWtydmt2Z3JhZ3pocm9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5Njg5NzUsImV4cCI6MjA1OTU0NDk3NX0.FaHsjIRNlgf6YWbe5foz0kJFtCO4FuVFo7KVcfhKPEk"
    );

    const fileInput = document.getElementById("logoUpload");
    const uploadButton = document.getElementById("uploadLogoBtn");
    const previewImg = document.getElementById("logoPreview");
    const sampleCanvas = document.getElementById("sampleCanvas");
    const ctx = sampleCanvas.getContext("2d");
    const LOGO_PATH = "https://dvzmnikrvkvgragzhrof.supabase.co/storage/v1/object/public/logos/logo.jpg";
    const BANK_STATEMENT_URL = "/sample-bank-statement.jpg";
    let selectedFile = null;

    function drawWatermark(logoUrl) {
      const background = new Image();
      const logo = new Image();

      background.src = BANK_STATEMENT_URL;
      logo.src = logoUrl;

      background.onload = () => {
        ctx.clearRect(0, 0, sampleCanvas.width, sampleCanvas.height);
        ctx.drawImage(background, 0, 0, sampleCanvas.width, sampleCanvas.height);

        logo.onload = () => {
          const tileSize = 180;
          const patternCanvas = document.createElement("canvas");
          patternCanvas.width = tileSize;
          patternCanvas.height = tileSize;
          const pctx = patternCanvas.getContext("2d");

          pctx.save();
          pctx.translate(tileSize / 2, tileSize / 2);
          pctx.rotate(-45 * Math.PI / 180);
          pctx.globalAlpha = 0.08;
          pctx.drawImage(logo, -50, -50, 100, 100);
          pctx.restore();

          const pattern = ctx.createPattern(patternCanvas, "repeat");
          ctx.fillStyle = pattern;
          ctx.fillRect(0, 0, sampleCanvas.width, sampleCanvas.height);
        };
      };
    }

    uploadButton.addEventListener("click", async () => {
      selectedFile = fileInput.files[0];
      if (!selectedFile) return alert("Please select a logo file first.");

      const { error } = await supabase.storage.from("logos").upload("logo.jpg", selectedFile, {
        upsert: true,
        cacheControl: "0"
      });

      if (error) return alert("❌ Upload failed: " + error.message);

      const newUrl = `${LOGO_PATH}?t=${Date.now()}`;
      previewImg.src = newUrl;
      drawWatermark(newUrl);
      fileInput.value = "";
    });

    window.onload = () => {
      const newUrl = `${LOGO_PATH}?t=${Date.now()}`;
      previewImg.src = newUrl;
      drawWatermark(newUrl);
    };
  </script>
</body>
</html>
